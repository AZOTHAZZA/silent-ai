<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数理的沈黙ベース生成AI</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e1e1e">
  <style>
    body { margin:0; font-family:"Segoe UI", sans-serif; background:#121212; color:#fff; }
    header { padding:1rem; text-align:center; background:#1f1f1f; font-size:1.2rem; }
    main { padding:1rem; }
    #networkStatus { font-size:0.9rem; color:#aaa; margin-bottom:0.5rem; }
    textarea { width:100%; height:100px; margin-bottom:0.5rem; background:#222; color:#fff; border:none; padding:0.5rem; border-radius:5px; font-family:monospace; }
    button { width:100%; padding:0.8rem; margin-bottom:1rem; border:none; border-radius:5px; background:#3a3a3a; color:#fff; font-size:1rem; }
    #output { white-space:pre-wrap; background:#222; padding:0.5rem; border-radius:5px; min-height:50px; }
  </style>
</head>
<body>
  <header>数理的沈黙ベース生成AI</header>
  <main>
    <div id="networkStatus">ネットワーク状態: 確認中...</div>
    <textarea id="input" placeholder="コマンドをはなす"></textarea>
    <button id="generateBtn">生成開始</button>
    <div id="output"></div>
  </main>

  <script type="module">
    import { checkOffline } from './app/offline.js';
    import { generate } from './ai/generator.js';
    import { updateUI } from './fusion/fusionUI.js';

    const inputEl = document.getElementById('input');
    const outputEl = document.getElementById('output');
    const networkStatusEl = document.getElementById('networkStatus');
    const generateBtn = document.getElementById('generateBtn');

    function updateNetworkStatus() {
      networkStatusEl.textContent = 'ネットワーク状態: ' + (checkOffline() ? 'オフライン' : 'オンライン');
    }

    generateBtn.addEventListener('click', async () => {
      const command = inputEl.value.trim();
      if (!command) return;
      const result = await generate(command);
      updateUI(result, outputEl);
    });

    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);
    updateNetworkStatus();

    // Service Worker 登録
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').then(() => {
        console.log('Service Worker 登録成功');
      }).catch(console.error);
    }
  </script>
</body>
</html>